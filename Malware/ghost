rule gh0st_rat_payload {
    meta:
        author =  "tcontre"
        description = "detecting gh0strat_payload in memory without MZ header in memory"
        date =  "2021-02-22"
        update = "2023-04-24"
        sha256 = "edffd5fc8eb86e2b20dd44e0482b97f74666edc2ec52966be19a6fe43358a5db,30b0b79df3b4f33972563b7d887dda7938e05856"

    strings:
        $dos = "DOS mode"	
        $av_str1 = "f-secure.exe"	
        $av_str2 = "Mcshield.exe"
        $av_str3 = "Sunbelt"
        $av_str4 = "baiduSafeTray.exe"
        $s1 = "[WIN]"
        $s2 = "[Print Screen]"
        $s3 = "Shellex"
        $s4 = "HARDWARE\\DESCRIPTION\\System\\CentralProcessor\\0" ascii wide
        //$s5 = "%s\\%d.bak"
        //$clsid = "{4D36E972-E325-11CE-BFC1-08002BE10318}"
    
    condition:
        ($dos at 0x6c) and 2 of ($av_str*) and 4 of ($s*) 

}

rule gh0st_rat_loader_2021 {
    meta:
        author =  "tcontre"
        description = "detecting gh0strat_loader"
        date =  "2021-02-22"
        update = "2023-04-24"
		sha256 = "70ac339c41eb7a3f868736f98afa311674da61ae12164042e44d6e641338ff1f"

    strings:
        $mz = { 4d 5a }

        $code = { 40 33 FF 89 45 E8 57 8A 04 10 8A 14 0E 32 D0 88 14 0E FF 15 ?? ?? ?? ?? 8B C6 B9 ?? 00 00 00 }
        $str1 = "Shellex"
        $str2 = "VirtualProtect"
       
    
    condition:
        ($mz at 0) and $code and all of ($str*)

}

rule gh0st_rat_loader_2023
{
    meta:
        author = "Invoker"
        md5 = ""
        date = "2023-04-22"
    strings:
        /*
        .text:0042BCCF C6 45 F8 53                       mov     [ebp+var_8], 'S'
        .text:0042BCD3 C6 45 F9 68                       mov     [ebp+var_7], 'h'
        .text:0042BCD7 C6 45 FA 65                       mov     [ebp+var_6], 'e'
        .text:0042BCDB C6 45 FB 6C                       mov     [ebp+var_5], 'l'
        .text:0042BCDF C6 45 FC 6C                       mov     [ebp+var_4], 'l'
        .text:0042BCE3 C6 45 FD 65                       mov     [ebp+var_3], 'e'
        .text:0042BCE7 C6 45 FE 78                       mov     [ebp+var_2], 'x'
        */
        //$str1 = {BE 16 CF 52 CD}
        $str2 = {C6 45 F? 53 C6 45 F? 68 C6 45 F? 65 C6 45 F? 6C C6 45 F? 6C C6 45 F? 65 C6 45 F? 78 }
    condition:
        uint16(0) == 0x5A4D and all of ($str*)
}
